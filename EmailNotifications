pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                // Tool: Maven
                echo 'Building the code using Maven...'
            }
        }

        stage('Unit and Integration Tests') {
            steps {
                script {
                    try {
                        // Tool: JUnit for unit tests
                        echo 'Running unit tests using JUnit...'
                        // Simulating unit tests
                        sleep(1)

                        // Tool: TestNG for integration tests
                        echo 'Running integration tests using TestNG...'
                        // Simulating integration tests
                        sleep(1)

                        // Notify success
                        currentBuild.result = 'SUCCESS'
                    } catch (Exception e) {
                        // Notify failure
                        currentBuild.result = 'FAILURE'
                    }
                }
            }
        }

        stage('Code Analysis') {
            steps {
                // Tool: SonarQube
                echo 'Analyzing code with SonarQube...'
            }
        }

        stage('Security Scan') {
            steps {
                script {
                    try {
                        // Tool: OWASP ZAP
                        echo 'Performing security scan using OWASP ZAP...'
                        // Simulating a security scan
                        sleep(1)

                        // Notify success
                        currentBuild.result = 'SUCCESS'
                    } catch (Exception e) {
                        // Notify failure
                        currentBuild.result = 'FAILURE'
                    }
                }
            }

        }

        stage('Deploy to Staging') {
            steps {
                // Tool: AWS CLI for deployment
                echo 'Deploying to staging server on AWS EC2...'
            }
        }

        stage('Integration Tests on Staging') {
            steps {
                // Tool: Selenium for integration testing
                echo 'Running integration tests on the staging environment using Selenium...'
            }
        }

        stage('Deploy to Production') {
            steps {
                // Tool: AWS CLI for production deployment
                echo 'Deploying to production server on AWS EC2...'
            }
        }
        stage('Prompt check') {
            steps {
                mail to: 'situ.xiaolin667@gmail.com',
                     cc: 'situsnow@gmail.com', // Fixed: Corrected missing 'l' in 'gmail.com'
                     subject: 'Test actual run02', 
                     body: 'Test actual run02'
            }
        }
    }
}
